<!-- <line x1='{{x(X0)}}' x2='{{x(X3)}}' y1='{{y(Y0)}}' y2='{{y(Y3)}}'/> -->

<polyline points='
	{{x(X0)}},{{y(Y0)}}
	{{x(X1)}},{{y(Y1)}}
	{{x(X2)}},{{y(Y2)}}
	{{x(X3)}},{{y(Y3)}}
'/>

<polyline points='
	{{x(q0.time)}},{{y(q0.value)}}
	{{x(q1.time)}},{{y(q1.value)}}
	{{x(q2.time)}},{{y(q2.value)}}
'/>

<polyline points='
	{{x(r0.time)}},{{y(r0.value)}}
	{{x(r1.time)}},{{y(r1.value)}}
'/>

<!-- <line x1='{{x(q0.time)}}' x2='{{x(q2.time)}}' y1='{{y(q0.value)}}' y2='{{y(q2.value)}}'/> -->

<!-- <circle cx='{{x(q0.add(q0_q2t).time)}}' cy='{{y(q0.add(q0_q2t).value)}}' r='3'/>
<line class='crossover' x1='{{x(crossover)}}' x2='{{x(crossover)}}' y1=0 y2=100%/> -->

<!-- <g transform='translate({{x(q0.time)}},{{y(q0.value)}})'>
	<circle class='control-point' r='2'/>
	<text>q0</text>
</g>

<g transform='translate({{x(q1.time)}},{{y(q1.value)}})'>
	<circle class='control-point' r='2'/>
	<text>q1</text>
</g>

<g transform='translate({{x(q2.time)}},{{y(q2.value)}})'>
	<circle class='control-point' r='2'/>
	<text>q2</text>
</g> -->


<circle
	class='control-point'
	cx='{{x(b.time)}}'
	cy='{{y(b.value)}}'
	r='2'
/>

<!-- <line
	class='control-point-link'
	x1='{{x(segment.p0.time)}}'
	y1='{{y(segment.p0.value)}}'
	x2='{{x(segment.p1.time)}}'
	y2='{{y(segment.p1.value)}}'
/> -->
<!-- <circle
	class='control-point'
	cx='{{x(segment.p1.time)}}'
	cy='{{y(segment.p1.value)}}'
	r='2'
/> -->
<!-- <circle
	class='control-point-progress'
	cx='{{x(segment.p0.time + segment.p0.rightControlPoint.scale(p).time)}}'
	cy='{{y(segment.p0.value + segment.p0.rightControlPoint.scale(p).value)}}'
	r='5'
/> -->


<!-- <line
	class='control-point-link'
	x1='{{x(segment.p2.time)}}'
	y1='{{y(segment.p2.value)}}'
	x2='{{x(segment.p3.time)}}'
	y2='{{y(segment.p3.value)}}'
/> -->
<!-- <circle
	class='control-point'
	cx='{{x(segment.p2.time)}}'
	cy='{{y(segment.p2.value)}}'
	r='2'
/> -->
<!-- <circle
	class='control-point-progress'
	cx='{{x(segment.p3.time + segment.p3.leftControlPoint.scale(1 - p).time)}}'
	cy='{{y(segment.p3.value + segment.p3.leftControlPoint.scale(1 - p).value)}}'
	r='5'
/> -->

<style>
	.control-point {
		stroke: black;
		fill: blue;
	}

	.control-point-progress {
		stroke: black;
		fill: green;
	}

	.control-point-link {
		stroke: #aaa;
	}

	polyline {
		fill: none;
		stroke: rgba(0,0,0,0.2);
		stroke-width: 2;
		stroke-dasharray: 2 2;
	}

	line {
		stroke-width: 2;
		stroke: red;
	}

	.crossover {
		stroke: blue;
	}
</style>

<script>
	export default {
		namespace: 'svg',

		computed: {
			X0: segment => segment.p0.time,
			X1: segment => segment.p1.time,
			X2: segment => segment.p2.time,
			X3: segment => segment.p3.time,

			Y0: segment => segment.p0.value,
			Y1: segment => segment.p1.value,
			Y2: segment => segment.p2.value,
			Y3: segment => segment.p3.value,

			crossover: (X0, X1, X2, X3, t) => {
				const q0 = X0 + (X1 - X0) * t;
				const q1 = X2 + (X3 - X2) * t;
				const q0_q1 = q1 - q0;

				return (
					q0 + q0_q1 * t
				);

				// return (
				// 	(X0 + (X1 - X0) * t) +
				// 	((X2 + (X3 - X2) * t) - (X0 + (X1 - X0) * t)) * t
				// );
			},

			// X0_1: (X0, X1) => X1 - X0,
			// X1_2: (X1, X2) => X2 - X1,
			// X2_3: (X2, X3) => X3 - X2,

			p0_p1: segment => segment.p1.subtract(segment.p0),
			p1_p2: segment => segment.p2.subtract(segment.p1),
			p2_p3: segment => segment.p3.subtract(segment.p2),

			q0: (segment, p0_p1, t) => segment.p0.add(p0_p1.scale(t)),
			q1: (segment, p1_p2, t) => segment.p1.add(p1_p2.scale(t)),
			q2: (segment, p2_p3, t) => segment.p2.add(p2_p3.scale(t)),

			q0_q1: (q0, q1) => q1.subtract(q0),
			q1_q2: (q1, q2) => q2.subtract(q1),

			q0_q2: (q0, q2) => q2.subtract(q0),
			q0_q2t: (q0_q2, t) => q0_q2.scale(t),

			r0: (q0, q0_q1, t) => q0.add(q0_q1.scale(t)),
			r1: (q1, q1_q2, t) => q1.add(q1_q2.scale(t)),

			r0_r1: (r0, r1) => r1.subtract(r0),

			b: (r0, r0_r1, t) => r0.add(r0_r1.scale(t))
		}
	};
</script>